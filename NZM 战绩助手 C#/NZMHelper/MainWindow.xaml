<Window x:Class="NZMHelper.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="NZM 战绩助手 V1.3 (双区版)" Height="900" Width="1300"
        Background="{StaticResource BgBrush}" WindowStartupLocation="CenterScreen">

    <Window.Resources>
        <Style TargetType="TextBlock" x:Key="TitleText">
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>
        <Style TargetType="Border" x:Key="SectionHeader">
            <Setter Property="BorderBrush" Value="{StaticResource AccentBrush}"/>
            <Setter Property="BorderThickness" Value="4,0,0,0"/>
            <Setter Property="Padding" Value="10,0,0,0"/>
            <Setter Property="Margin" Value="0,20,0,10"/>
        </Style>
        <Style TargetType="Button" x:Key="TabBtn">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#ccc"/>
            <Setter Property="BorderBrush" Value="#444"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Margin" Value="0,0,5,0"/>
            <Setter Property="Width" Value="60"/>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid x:Name="LoginGrid" Visibility="Visible">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center" Width="450">
                <Border Background="{StaticResource CardBgBrush}" CornerRadius="10" Padding="20" Margin="0,0,0,25">
                    <StackPanel>
                        <Grid Margin="0,0,0,15">
                            <TextBlock Text="公告 &amp; 关于" Foreground="White" FontSize="18" FontWeight="Bold" VerticalAlignment="Center"/>
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                <Button Content="检查更新" Click="BtnCheckUpdate_Click" Background="{StaticResource GreenBrush}" Foreground="White" FontSize="12" Height="28" Width="80" Margin="0,0,10,0"/>
                                <Button Content="作者信息" Click="BtnAuthorInfo_Click" Background="{StaticResource AccentBrush}" Foreground="White" FontSize="12" Height="28" Width="80"/>
                            </StackPanel>
                        </Grid>
                        <StackPanel>
                            <TextBlock Text="⚠️ 数据说明" Foreground="White" FontWeight="Bold" FontSize="13" Margin="0,0,0,3"/>
                            <TextBlock Text="官方数据为历史总计（不含机甲）。详细分析基于最近 30 天 / 100 场游戏记录。" Foreground="#94a3b8" FontSize="12" Margin="20,0,0,10"/>
                            <TextBlock Text="🕒 过期机制" Foreground="{StaticResource AccentBrush}" FontWeight="Bold" FontSize="13" Margin="0,0,0,3"/>
                            <TextBlock Text="本地保存的Cookie将在 24小时 后自动过期，需重新登录。" Foreground="#94a3b8" FontSize="12" Margin="20,0,0,10"/>
                            <TextBlock Text="🚫 严禁盗卖" Foreground="{StaticResource RedBrush}" FontWeight="Bold" FontSize="13" Margin="0,0,0,3"/>
                            <TextBlock Text="倒卖死全家 倒卖死全家 倒卖死全家 （重要的事情说三遍）" Foreground="#94a3b8" FontSize="12" Margin="20,0,0,0"/>
                        </StackPanel>
                    </StackPanel>
                </Border>

                <Border Background="{StaticResource CardBgBrush}" CornerRadius="10" Padding="20">
                    <TabControl Background="Transparent" BorderThickness="0" AutomationProperties.Name="登录方式选项卡">
                        <TabItem Header="QQ登录 (Q区)" Foreground="Black" FontSize="13">
                            <StackPanel Margin="0,30,0,20">
                                <TextBlock Text="手机QQ扫码" Foreground="#aaa" FontWeight="Bold" HorizontalAlignment="Center" Margin="0,0,0,15"/>
                                <Border Background="Transparent" Width="140" Height="140" HorizontalAlignment="Center" Margin="0,0,0,10">
                                    <Image x:Name="QrImage" Stretch="Uniform"/>
                                </Border>
                                <TextBlock x:Name="QrStatusText" Text="点击下方按钮获取二维码" Foreground="#666" HorizontalAlignment="Center" FontSize="12" Margin="0,0,0,20"/>
                                <Button Content="获取二维码" Click="BtnGetQr_Click" HorizontalAlignment="Center" Width="160" Height="38" Background="{StaticResource AccentBrush}" FontSize="14"/>
                            </StackPanel>
                        </TabItem>

                        <TabItem Header="微信登录 (微区)" Foreground="Black" FontSize="13">
                            <StackPanel Margin="0,30,0,20">
                                <TextBlock Text="粘贴抓包获取的 Cookie" Foreground="Black" FontWeight="Bold" FontSize="15" HorizontalAlignment="Center" Margin="0,0,0,15"/>
                                <TextBox x:Name="WxCookieInput" AutomationProperties.Name="微信Cookie输入框" Height="120" TextWrapping="Wrap" Background="White" Foreground="Black" BorderThickness="0" Padding="8" Margin="20,0,20,10" VerticalContentAlignment="Top"/>
                                <TextBlock Text="提示: 我们不会保存你的Cookie" Foreground="#888" HorizontalAlignment="Center" Margin="0,0,0,20" FontSize="12"/>
                                <Button Content="登录查询" Click="BtnLoginManual_Click" HorizontalAlignment="Center" Width="160" Height="38" Background="{StaticResource AccentBrush}" FontSize="14"/>
                            </StackPanel>
                        </TabItem>
                    </TabControl>
                </Border>
            </StackPanel>
        </Grid>

        <Grid x:Name="MainGrid" Visibility="Collapsed">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <Border Background="#0B1120" Padding="20,15">
                <Grid>
                    <TextBlock x:Name="TxtAppTitle" Text="NZM 战绩助手" Foreground="White" FontSize="20" FontWeight="Bold"/>
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                        <Button Content="公告" Click="BtnAuthorInfo_Click" Margin="0,0,10,0" Background="{StaticResource AccentBrush}"/>
                        <Button Content="刷新" Click="BtnRefresh_Click" Margin="0,0,10,0" Background="{StaticResource GreenBrush}"/>
                        <Button Content="注销" Click="BtnLogout_Click" Background="{StaticResource RedBrush}"/>
                    </StackPanel>
                </Grid>
            </Border>

            <TabControl Grid.Row="1" Background="Transparent" BorderThickness="0" Margin="10" AutomationProperties.Name="功能选项卡">
                <TabItem Header="战绩概览" Foreground="Black" FontSize="14">
                    <ScrollViewer Padding="20">
                        <StackPanel>
                            <Border Style="{StaticResource SectionHeader}">
                                <TextBlock Text="官方历史数据 (不含机甲/PVP)" Style="{StaticResource TitleText}"/>
                            </Border>
                            <UniformGrid Columns="2">
                                <Border Background="{StaticResource CardBgBrush}" CornerRadius="8" Padding="20" Margin="0,0,5,0">
                                    <StackPanel>
                                        <TextBlock Text="历史总场次" Foreground="#94a3b8"/>
                                        <TextBlock x:Name="TxtTotalGames" Text="--" Foreground="White" FontSize="28" FontWeight="Bold"/>
                                    </StackPanel>
                                </Border>
                                <Border Background="{StaticResource CardBgBrush}" CornerRadius="8" Padding="20" Margin="5,0,0,0">
                                    <StackPanel>
                                        <TextBlock Text="历史总时长" Foreground="#94a3b8"/>
                                        <TextBlock x:Name="TxtTotalHours" Text="--" Foreground="White" FontSize="28" FontWeight="Bold"/>
                                    </StackPanel>
                                </Border>
                            </UniformGrid>

                            <Border Style="{StaticResource SectionHeader}">
                                <TextBlock Text="近期战绩统计 (最近30天/100场)" Style="{StaticResource TitleText}"/>
                            </Border>
                            <UniformGrid Columns="3">
                                <Border Background="{StaticResource CardBgBrush}" CornerRadius="8" Padding="20" Margin="0,0,5,0">
                                    <StackPanel>
                                        <TextBlock Text="近期场次" Foreground="#94a3b8"/>
                                        <TextBlock x:Name="TxtRecentCount" Text="--" Foreground="White" FontSize="28" FontWeight="Bold"/>
                                    </StackPanel>
                                </Border>
                                <Border Background="{StaticResource CardBgBrush}" CornerRadius="8" Padding="20" Margin="5,0,5,0">
                                    <StackPanel>
                                        <TextBlock Text="近期胜率" Foreground="#94a3b8"/>
                                        <TextBlock x:Name="TxtRecentWinRate" Text="--" Foreground="White" FontSize="28" FontWeight="Bold"/>
                                    </StackPanel>
                                </Border>
                                <Border Background="{StaticResource CardBgBrush}" CornerRadius="8" Padding="20" Margin="5,0,0,0">
                                    <StackPanel>
                                        <TextBlock Text="场均伤害" Foreground="#94a3b8"/>
                                        <TextBlock x:Name="TxtRecentAvgDmg" Text="--" Foreground="White" FontSize="28" FontWeight="Bold"/>
                                    </StackPanel>
                                </Border>
                            </UniformGrid>

                            <Border Style="{StaticResource SectionHeader}">
                                <TextBlock Text="模式统计" Style="{StaticResource TitleText}"/>
                            </Border>
                            <ItemsControl x:Name="ModeStatList" AutomationProperties.Name="模式统计列表">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <UniformGrid Columns="3"/>
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Background="{StaticResource CardBgBrush}" CornerRadius="8" Margin="5" Padding="15">
                                            <StackPanel>
                                                <TextBlock Text="{Binding Name}" Foreground="#94a3b8" FontSize="12"/>
                                                <TextBlock Text="{Binding TotalText}" Foreground="White" FontSize="24" FontWeight="Bold" Margin="0,5,0,5"/>
                                                <TextBlock Text="{Binding DetailText}" Foreground="#94a3b8" FontSize="11"/>
                                            </StackPanel>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>

                            <Border Style="{StaticResource SectionHeader}">
                                <TextBlock Text="地图详情 (近100场)" Style="{StaticResource TitleText}"/>
                            </Border>
                            <ItemsControl x:Name="MapStatList" AutomationProperties.Name="地图详情列表">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <UniformGrid Columns="3"/>
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Background="{StaticResource CardBgBrush}" CornerRadius="8" Margin="5" Height="150" ClipToBounds="True">
                                            <Grid>
                                                <Image Source="{Binding Icon}" Stretch="UniformToFill" Opacity="0.4"/>
                                                <DockPanel Margin="15">
                                                    <Grid DockPanel.Dock="Top">
                                                        <StackPanel HorizontalAlignment="Left">
                                                            <TextBlock Text="{Binding Name}" Foreground="White" FontWeight="Bold" FontSize="18"/>
                                                            <TextBlock Text="{Binding TotalWinRate}" Foreground="#cbd5e1" FontSize="12" Margin="0,2,0,0"/>
                                                        </StackPanel>
                                                        <TextBlock Text="{Binding Mode}" Foreground="{StaticResource AccentBrush}" HorizontalAlignment="Right" FontWeight="Bold"/>
                                                    </Grid>
                                                    <Grid DockPanel.Dock="Bottom" VerticalAlignment="Bottom">
                                                        <ItemsControl ItemsSource="{Binding Diffs}" HorizontalAlignment="Right">
                                                            <ItemsControl.ItemTemplate>
                                                                <DataTemplate>
                                                                    <TextBlock Text="{Binding DisplayText}" Foreground="White" FontSize="11" TextAlignment="Right" Margin="0,1,0,0"/>
                                                                </DataTemplate>
                                                            </ItemsControl.ItemTemplate>
                                                        </ItemsControl>
                                                    </Grid>
                                                </DockPanel>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>

                            <Border Style="{StaticResource SectionHeader}">
                                <TextBlock Text="对局记录" Style="{StaticResource TitleText}"/>
                            </Border>
                            <ItemsControl x:Name="GamesList" AutomationProperties.Name="对局记录列表">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Background="{StaticResource CardBgBrush}" CornerRadius="6" Margin="0,0,0,6" Padding="10" Cursor="Hand">
                                            <Border.InputBindings>
                                                <MouseBinding Gesture="LeftClick" Command="{Binding DataContext.OpenDetailCommand, RelativeSource={RelativeSource AncestorType=Window}}" CommandParameter="{Binding RoomId}"/>
                                            </Border.InputBindings>
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="140"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                <Border CornerRadius="4" ClipToBounds="True" Height="75">
                                                    <Image Source="{Binding MapIcon}" Stretch="UniformToFill"/>
                                                </Border>
                                                <StackPanel Grid.Column="1" Margin="20,0,0,0" VerticalAlignment="Center">
                                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                                                        <TextBlock Text="{Binding Result}" Foreground="{Binding ResultColor}" FontWeight="Bold" FontSize="20" Margin="0,0,15,0"/>
                                                        <TextBlock Text="{Binding Mode}" Foreground="{StaticResource RedBrush}" FontSize="14" VerticalAlignment="Bottom"/>
                                                    </StackPanel>
                                                    <TextBlock Text="{Binding DetailText}" Foreground="#64748b" FontSize="12"/>
                                                </StackPanel>
                                                <StackPanel Grid.Column="2" VerticalAlignment="Center" HorizontalAlignment="Right">
                                                    <TextBlock Text="{Binding Score}" Foreground="{StaticResource RedBrush}" FontSize="24" FontFamily="Impact" HorizontalAlignment="Right"/>
                                                    <TextBlock Text="{Binding Duration}" Foreground="White" FontSize="14" HorizontalAlignment="Right" FontWeight="Bold"/>
                                                </StackPanel>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                    </ScrollViewer>
                </TabItem>

                <TabItem Header="图鉴" Foreground="Black" FontSize="14">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        <StackPanel Margin="0,10">
                            <StackPanel Orientation="Horizontal" Margin="5">
                                <Button Content="武器" Click="SwitchColl_Click" Tag="weapon" Width="80" Background="#333"/>
                                <Button Content="插件" Click="SwitchColl_Click" Tag="plugin" Width="80" Background="#333" Margin="10,0,0,0"/>
                                <Button Content="塔防" Click="SwitchColl_Click" Tag="trap" Width="80" Background="#333" Margin="10,0,0,0"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="5,10,5,5">
                                <Button Content="全部" Click="FilterColl_Click" Tag="all" Style="{StaticResource TabBtn}" Background="{StaticResource AccentBrush}"/>
                                <Button Content="传说" Click="FilterColl_Click" Tag="4" Style="{StaticResource TabBtn}" BorderBrush="{StaticResource LegendaryBrush}" Foreground="{StaticResource LegendaryBrush}"/>
                                <Button Content="史诗" Click="FilterColl_Click" Tag="3" Style="{StaticResource TabBtn}" BorderBrush="{StaticResource EpicBrush}" Foreground="{StaticResource EpicBrush}"/>
                                <Button Content="稀有" Click="FilterColl_Click" Tag="2" Style="{StaticResource TabBtn}" BorderBrush="{StaticResource RareBrush}" Foreground="{StaticResource RareBrush}"/>
                            </StackPanel>
                            <TextBlock x:Name="TxtCollTitle" Text="武器图鉴 (0/0)" Foreground="White" FontWeight="Bold" FontSize="18" Margin="10,5,0,0"/>
                        </StackPanel>
                        <ScrollViewer Grid.Row="1">
                            <ItemsControl x:Name="CollectionList" AutomationProperties.Name="图鉴列表">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <UniformGrid Columns="6"/>
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Background="{Binding BgColor}" BorderThickness="1" BorderBrush="{Binding BorderColor}" Margin="5" Height="100">
                                            <Grid>
                                                <Image Source="{Binding Icon}" Margin="10,10,10,30"/>
                                                <TextBlock Text="{Binding Name}" Foreground="{Binding TextColor}" HorizontalAlignment="Center" VerticalAlignment="Bottom" Margin="0,0,0,10" FontSize="12"/>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>
                    </Grid>
                </TabItem>
            </TabControl>
        </Grid>
    </Grid>
</Window>